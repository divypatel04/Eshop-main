{% extends 'base.html' %}
{% load custom_filter %}
{% block style %}
	<style>
		.btn-grey{
			background-color:#D8D8D8;
			color:#FFF;
		}
		.rating-block{
			background-color:#fff;
			border:1px solid rgba(0, 0, 0, 0.175);
			padding:15px 15px 20px 15px;
			border-radius:3px;
		}
		.bold{
			font-weight:700;
		}
		.padding-bottom-7{
			padding-bottom:7px;
		}

		.review-block{
			background-color:#FAFAFA;
			border:1px solid #EFEFEF;
			padding:15px;
			border-radius:3px;
			margin-bottom:15px;
		}
		.review-block-name{
			font-size:12px;
			margin:10px 0;
		}
		.review-block-date{
			font-size:12px;
		}
		.review-block-rate{
			font-size:13px;
			margin-bottom:15px;
		}
		.review-block-title{
			font-size:15px;
			font-weight:700;
			margin-bottom:10px;
		}
		.review-block-description{
			font-size:13px;
		}
		.pull-right {
			float: right !important;
		}

		.pull-left{
			float:left !important;
		}

		.progress{
			background-color: #f5f5f5;
		}
		.progress-bar-success {
			background-color: #5cb85c;
		}
		.progress-bar-info {
			background-color: #5bc0de;
		}
		.progress-bar-warning {
			background-color: #f0ad4e;
		}
		.progress-bar-danger {
			background-color: #d9534f;
		}
	</style>
{% endblock %}
{% block content %}

{% load custom_filter %}
<!-- body -->
		<section style="background-color: #eee; height: auto;">
			<div class="container py-5">
			  <!-- <div class="row">
				<div class="col">
				  <nav aria-label="breadcrumb" class="bg-body-tertiary rounded-3 p-3 mb-4">
					<ol class="breadcrumb mb-0">
					  <li class="breadcrumb-item"><a href="#">Home</a></li>
					  <li class="breadcrumb-item"><a href="#">User</a></li>
					  <li class="breadcrumb-item active" aria-current="page">User Profile</li>
					</ol>
				  </nav>
				</div>
			  </div> -->
		  
			  <div class="row">
				<div class="col-lg-4">					
				  <div class="card mb-4">
					<div class="card-body text-center">
						<img src="{{ customer.image.url }}" alt="avatar"
							class="rounded-circle img-fluid" style="width: 150px;">
						<h5 class="my-3">{{ customer.first_name }} {{ customer.last_name }}</h5>
						<p class="text-muted mb-1">{{ customer.position }}</p>
						<!-- <p class="text-muted mb-4">Bay Area, San Francisco, CA</p> -->
						<!-- <div class="d-flex justify-content-center mb-2">
							<button  type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-primary mx-2">Follow</button>
							<button  type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-outline-primary ms-1">Message</button>
						</div> -->
					</div>
				  </div>
				  {% if is_connected %}
				  <div class="card mb-4 mb-lg-0">
					<div class="card-body p-0">
						<p class="py-3 px-3"> <b>Social Links</b>
							 <!-- <a href="#" class="ml-2 float-right rounded-circle" data-bs-toggle="modal" data-bs-target="#skillsModal1"><span class="text-primary font-italic me-1"><span class="icon-circle">
							<i class="fas fa-pen"></i>
						</span></span> </a> -->
						  </p>
					  <ul class="list-group list-group-flush rounded-3">
						<!-- <li class="list-group-item d-flex justify-content-between align-items-center p-3">
						  <i class="fas fa-linkedin fa-lg text-warning"></i>
						  <p class="mb-0">{{ customer.linkedin }}</p>
						</li> -->
						<li class="list-group-item d-flex justify-content-between align-items-center p-3">
						  <i class="fab fa-linkedin fa-lg text-body mr-2" style="color: #0765ad;"></i>
						  <p class="mb-0">{{ customer.linkedin }}</p>
						</li>
						<li class="list-group-item d-flex justify-content-between align-items-center p-3">
						  <i class="fab fa-twitter fa-lg mr-2" style="color: #55acee;"></i>
						  <p class="mb-0">{{ customer.twitter }}</p>
						</li>
						<li class="list-group-item d-flex justify-content-between align-items-center p-3">
						  <i class="fab fa-instagram fa-lg mr-2" style="color: #ac2bac;"></i>
						  <p class="mb-0">{{ customer.instagram }}</p>
						</li>
						<li class="list-group-item d-flex justify-content-between align-items-center p-3">
						  <i class="fab fa-facebook-f fa-lg mr-2" style="color: #3b5998;"></i>
						  <p class="mb-0">{{ customer.facebook }}</p>
						</li>
					  </ul>
					</div>
				  </div>
				  {% endif %}
				</div>
				
				<div class="col-lg-8">
				  <div class="card mb-4">
					<div class="card-body">
						
					  <div class="row">
						<div class="col-sm-3">
						  <p class="mb-0"><b>Full Name</b></p>
						</div>
						<div class="col-sm-9">
						  <p class="text-muted mb-0">{{ customer.first_name }} {{ customer.last_name }}</p>
						</div>
					  </div>
					  <hr>
					  <div class="row">
						<div class="col-sm-3">
						  <p class="mb-0"><b>Email</b></p>
						</div>
						<div class="col-sm-9">
						  <p class="text-muted mb-0">{{ customer.email }}</p>
						</div>
					  </div>
					  <hr>
					  
					  <div class="row">
						<div class="col-sm-3">
						  <p class="mb-0"><b>Position</b></p>
						</div>
						<div class="col-sm-9">
						  <p class="text-muted mb-0">{{ customer.position }}</p>
						</div>
					  </div>
					  
					  {% if is_connected %}
					  <!-- <hr> -->
					  <!-- <div class="row">
						<div class="col-sm-3">
						  <p class="mb-0"><b>Phone</b></p>
						</div>
						<div class="col-sm-9">
						  <p class="text-muted mb-0">{{ customer.phone }}</p>
						</div>
					  </div>
					  <hr>	 
					  <div class="row">
						<div class="col-sm-3">
						  <p class="mb-0"><b>Address</b></p>
						</div>
						<div class="col-sm-9">
						  <p class="text-muted mb-0">{{ customer.address }}</p>
						</div>
					  </div> -->
					  {% endif %}
					</div>
				  </div>
				 
				  <div class="row mb-4">
					<div class="col-md-5">
						<div class="rating-block">
							<p><b>Average user rating</b></p>
							<h2 class="bold padding-bottom-7">{{ average_rating }} <small>/ 5</small></h2>
							{% if average_rating %}
								{% for star in stars_range %}
									<button type="button" class="btn btn-warning btn-sm" aria-label="Left Align">
										<span class="fas fa-star text-white" aria-hidden="true"></span>
									</button>
								{% endfor %}
							{% endif %}
						</div>
					</div>
					<div class="col-md-7">
						<div class="card">
							<div class="card-body">
								<p><b>Rating breakdown</b></p>
								{% for star, count in star_counts.items %}
									{% if star == 5 %}
									<div class="pull-left">
										<div class="pull-left" style="width:35px; line-height:1;">
											<div style="height:9px; margin:5px 0;">5 <span class="fas fa-star text-warning"></span></div>
										</div>
										<div class="pull-left" style="width:180px;">
											<div class="progress" style="height:9px; margin:8px 0;">
											<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="5" style="width: 1000%">
												<span class="sr-only">80% Complete (danger)</span>
											</div>
											</div>
										</div>
										<div class="pull-right" style="margin-left:10px;">{{count}}</div>
									</div>
									{% endif %}
									{% if star == 4 %}
									<div class="pull-left">
										<div class="pull-left" style="width:35px; line-height:1;">
											<div style="height:9px; margin:5px 0;">4 <span class="fas fa-star text-warning"></span></div>
										</div>
										<div class="pull-left" style="width:180px;">
											<div class="progress" style="height:9px; margin:8px 0;">
											  <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="4" aria-valuemin="0" aria-valuemax="5" style="width: 80%">
												<span class="sr-only">80% Complete (danger)</span>
											  </div>
											</div>
										</div>
										<div class="pull-right" style="margin-left:10px;">{{count}}</div>
									</div>
									{% endif %}
									{% if star == 3 %}
									<div class="pull-left">
										<div class="pull-left" style="width:35px; line-height:1;">
											<div style="height:9px; margin:5px 0;">3 <span class="fas fa-star text-warning"></span></div>
										</div>
										<div class="pull-left" style="width:180px;">
											<div class="progress" style="height:9px; margin:8px 0;">
											  <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="3" aria-valuemin="0" aria-valuemax="5" style="width: 60%">
												<span class="sr-only">80% Complete (danger)</span>
											  </div>
											</div>
										</div>
										<div class="pull-right" style="margin-left:10px;">{{count}}</div>
									</div>
									{% endif %}
									{% if star == 2 %}
									<div class="pull-left">
										<div class="pull-left" style="width:35px; line-height:1;">
											<div style="height:9px; margin:5px 0;">2 <span class="fas fa-star text-warning"></span></div>
										</div>
										<div class="pull-left" style="width:180px;">
											<div class="progress" style="height:9px; margin:8px 0;">
											  <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="2" aria-valuemin="0" aria-valuemax="5" style="width: 40%">
												<span class="sr-only">80% Complete (danger)</span>
											  </div>
											</div>
										</div>
										<div class="pull-right" style="margin-left:10px;">{{count}}</div>
									</div>
									{% endif %}
									{% if star == 1 %}
									<div class="pull-left">
										<div class="pull-left" style="width:35px; line-height:1;">
											<div style="height:9px; margin:5px 0;">1 <span class="fas fa-star text-warning"></span></div>
										</div>
										<div class="pull-left" style="width:180px;">
											<div class="progress" style="height:9px; margin:8px 0;">
											  <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="1" aria-valuemin="0" aria-valuemax="5" style="width: 20%">
												<span class="sr-only">80% Complete (danger)</span>
											  </div>
											</div>
										</div>
										<div class="pull-right" style="margin-left:10px;">{{count}}</div>
									</div>
									{% endif %}
								{% endfor %}
							</div>
						</div>
					</div>			
				  </div>		

				  <div class="row">
					<div class="col-md-12">
					  <div class="card mb-4 mb-md-0">
						<div class="card-body">
						  <p class="mb-4"> <b>Skills</b> 
							<!-- <a href="#" class="ml-2 float-right rounded-circle" data-bs-toggle="modal" data-bs-target="#skillsModal"><span class="text-primary font-italic me-1"><span class="icon-circle">
							<i class="fas fa-pen"></i>
						</span></span> </a> -->
						  </p>
						  {% for skill in skills %}
						  <!-- <p class="mb-1" style="font-size: .77rem;">{{ skill}}</p> -->
						  	<span class="badge bg-primary text-white py-2 px-3" style="font-size: 1rem; border-radius: 50px;">{{ skill}}</span>
					  	  {% endfor %}
							
						  <!-- <p class="mb-1" style="font-size: .77rem;">Web Design</p>
						  <div class="progress rounded" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 80%" aria-valuenow="80"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div>
						  <p class="mt-4 mb-1" style="font-size: .77rem;">Website Markup</p>
						  <div class="progress rounded" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 72%" aria-valuenow="72"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div>
						  <p class="mt-4 mb-1" style="font-size: .77rem;">One Page</p>
						  <div class="progress rounded" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 89%" aria-valuenow="89"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div>
						  <p class="mt-4 mb-1" style="font-size: .77rem;">Mobile Template</p>
						  <div class="progress rounded" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 55%" aria-valuenow="55"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div>
						  <p class="mt-4 mb-1" style="font-size: .77rem;">Backend API</p>
						  <div class="progress rounded mb-2" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 66%" aria-valuenow="66"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div> -->
						</div>
					  </div>
					</div>
					
					<!-- <div class="col-md-6">
					  <div class="card mb-4 mb-md-0">
						<div class="card-body">
						  <p class="mb-4"><span class="text-primary font-italic me-1">assigment</span> Project Status
						  </p>
						  <p class="mb-1" style="font-size: .77rem;">Web Design</p>
						  <div class="progress rounded" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 80%" aria-valuenow="80"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div>
						  <p class="mt-4 mb-1" style="font-size: .77rem;">Website Markup</p>
						  <div class="progress rounded" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 72%" aria-valuenow="72"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div>
						  <p class="mt-4 mb-1" style="font-size: .77rem;">One Page</p>
						  <div class="progress rounded" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 89%" aria-valuenow="89"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div>
						  <p class="mt-4 mb-1" style="font-size: .77rem;">Mobile Template</p>
						  <div class="progress rounded" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 55%" aria-valuenow="55"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div>
						  <p class="mt-4 mb-1" style="font-size: .77rem;">Backend API</p>
						  <div class="progress rounded mb-2" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 66%" aria-valuenow="66"
							  aria-valuemin="0" aria-valuemax="100"></div>
						  </div>
						</div>
					  </div>
					</div> -->
				  </div>

				  <div class="row">
					<div class="col-sm-12">
						<div class="card mt-4">
							<div class="card-body">
								<p class="px-3"><b>Reviews</b></p>
							</div>
						</div>
						<div class="review-block">
							{% if ratings %}
							{% for rating in ratings %}
								<div class="row">
									<div class="col-sm-3">
										<img src="{{ rating.rater.image.url }}" width="70px" height="70px" class="img-rounded-circle rounded-circle" >
										<div class="review-block-name">{{ rating.rater.first_name }} {{ rating.rater.last_name }}</div>
										<!-- <div class="review-block-date">{{ rating.rater.datetime }}</div> -->
									</div>
									<div class="col-sm-9">
										<div class="review-block-rate">
											{% if  rating.stars %}
											{% for i in rating.stars|range_filter %}
												
													<button type="button" class="btn btn-warning btn-xs" aria-label="Left Align">
														<span class="fas fa-star text-white" aria-hidden="true"></span>
													</button>
												
												{% endfor %}
											{% endif %}
										</div>
										<!-- <div class="review-block-title">this was nice in buy</div> -->
										<div class="review-block-description">{{ rating.comment }}</div>
									</div>
								</div>
								<hr/>
								{% endfor %}
								
							{% else %}
								<div class="row">
									<div class="text-center">
										<p class="text-primary"><b>No reviews found for this profile.</b></p>
									</div>
								</div>
							{% endif %}
						</div>
					</div>
				  </div> 
				</div>
			</div>
			{% if is_connected %}
				{% else %}
					{% if connection_request %}
						{% if connection_request.status == "sent" %}
							<form action="{% url 'withdraw_request' connection_request.id %}" method="post">
								{% csrf_token %}
								<button class="btn btn-danger float-right ml-2 my-2 mb-2">Withdraw</button>
							</form>
						{% elif connection_request.status == "withdrawn" %}
							<form action="{% url 'send_request' customer.id %}" method="post">
								{% csrf_token %}
								<button class="btn btn-primary float-right ml-2 my-2 mb-2">Connect</button>
							</form>
						{% elif connection_request.status == "accepted" %}
							<p class="btn btn-warning ml-2 float-right my-2 mb-2">Connected</p>
							
						{% elif connection_request.status == "rejected" %}
							<p class="btn btn-warning ml-2 float-right my-2 mb-2">Request Rejected</p>
						{% endif %}
					{% else %}
						<form action="{% url 'send_request' customer.id %}" method="post">
							{% csrf_token %}
							<button class="btn btn-primary ml-2 float-right my-2 mb-2">Connect</button>
						</form>
					{% endif %}
					<!-- {% if is_request_sent %}
						<a href="{% url 'withdraw_request' connection_request.id %}" class="btn btn-danger float-right">Withdraw</a>
					{% else %}
						<div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center p-3 mb-2">
							<h5>Please connect to view full profile.</h5>
							<a href="{% url 'send_request' customer.id %}" class="btn btn-primary float-right">Connect</a>
						</div> -->
					<!-- {% endif %} -->
				{% endif %}
				<a class="btn btn-primary float-right ml-2 my-2 mb-2" href="{% url 'chat_window' customer.id %}">Message</a>
				<a href="#" class="btn btn-primary ml-2 float-right my-2 mb-2" onclick="goBack()">Back</a>
				<button type="button" class="btn btn-primary float-right my-2 mb-2 ml-2" data-bs-toggle="modal" data-bs-target="#rateCustomerModal">
					Rate this user
				</button>
		  </section>
		

		<div class="modal fade" id="skillsModal" tabindex="-1" aria-labelledby="skillsModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="skillsModalLabel">Add Skills</h5>
					</div>
					<div class="modal-body">
						<!-- Input to add new skill -->
						<div class="input-group mb-3">
							<input type="text" id="skillInput" class="form-control" placeholder="Enter skill">
							<button class="btn btn-outline-secondary" type="button" onclick="addSkill()">Add</button>
						</div>
						<!-- Area to display added skills as tags -->
						<div id="skillsContainer" class="d-flex flex-wrap gap-2">
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						<!-- Save skills button -->
						<button type="button" class="btn btn-primary" onclick="saveSkills()">Save Skills</button>
					</div>
				</div>
			</div>
		</div>
	

		<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
			  <div class="modal-content">
				<div class="modal-header">
				  <h5 class="modal-title" id="successModalLabel">Success</h5>
				</div>
				<div class="modal-body">
				  Skills updated successfully!
				</div>
				<div class="modal-footer">
				  <button type="button" class="btn btn-primary" id="reloadButton">OK</button>
				</div>
			  </div>
			</div>
		</div>

		<div class="modal fade" id="rateCustomerModal" tabindex="-1" aria-labelledby="rateCustomerModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="rateCustomerModalLabel">Rate Customer</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form id="ratingForm">
							<div class="mb-3">
								<label for="stars" class="form-label">Stars</label>
								<select class="form-select" id="stars" required>
									<option value="">Select stars</option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="5">5</option>
								</select>
							</div>
							<div class="mb-3">
								<label for="comment" class="form-label">Write your Review</label>
								<textarea class="form-control" id="comment" rows="3" placeholder="Write a review"></textarea>
							</div>
							<button type="button" class="btn btn-primary" id="submitRating">Submit Rating</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
		<script>
			// Array to store skills
			let skills = [];
			fetchSkills();
			// Function to add a skill
			function addSkill() {
				const skillInput = document.getElementById("skillInput");
				const skill = skillInput.value.trim();
				
				if (skill && !skills.includes(skill)) {
					skills.push(skill);
					renderSkills();
					skillInput.value = ""; // Clear input
				}
			}
		
			// Function to remove a skill
			function removeSkill(skill) {
				skills = skills.filter(s => s !== skill);
				renderSkills();
			}
		
			// function fetchSkills() {
			// 	fetch('/profile',{
			// 		method: 'GET',
			// 	headers: {
			// 		'Content-Type': 'application/json',
			// 		'X-CSRFToken': '{{ csrf_token }}'  // Django's CSRF token for security
			// 	}
			// 	})
			// 		.then(response => response.json())
			// 		.then(data => {
			// 			    console.log(skills);
			// 				skillsArray = data.skills; // Store fetched skills
			// 				// updateSkillsDisplay();
			// 				const skillsContainer = document.getElementById("skillsContainer");
			// 	skillsContainer.innerHTML = "";
			// 				skillsArray.forEach(skill => {
			// 					const skillTag = document.createElement("span");
			// 					skillTag.className = "badge bg-primary d-flex align-items-center text-white rounded";
			// 					skillTag.style.margin = "5px";
			// 					skillTag.innerHTML = `
			// 						${skill}
			// 						<a href="#" class="btn-close btn-close-white rounded-circle mx-2 text-white my-1 text-decoration-none" aria-label="Remove" onclick="removeSkill('${skill}')"> x </a>
			// 					`;
			// 					skillsContainer.appendChild(skillTag);
			// 				});
								
			// 		})
			// 		.catch(error => console.error('Error:', error));
			// }


			// Function to render skills as tags
			function renderSkills() {
				const skillsContainer = document.getElementById("skillsContainer");
				skillsContainer.innerHTML = ""; // Clear existing skills
		        
				skills.forEach(skill => {
					const skillTag = document.createElement("span");
					skillTag.className = "badge bg-primary d-flex align-items-center text-white rounded";
					skillTag.style.margin = "5px";
					skillTag.innerHTML = `
						${skill}
						<a href="#" class="btn-close btn-close-white rounded-circle mx-2 text-white my-1 text-decoration-none" aria-label="Remove" onclick="removeSkill('${skill}')"> x </a>
					`;
					skillsContainer.appendChild(skillTag);
				});
			}
		

			function saveSkills() {
				fetch('/profile', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'X-CSRFToken': '{{ csrf_token }}'  // Django's CSRF token for security
				},
				body: JSON.stringify({ skills: skills })
				})
				.then(response => response.json())
				.then(data => {
				if (data.status === 'success') {
					$('#skillsModal').modal('hide');
					$('#successModal').modal('show');
				} else {
					alert("Error saving skills. Please try again.");
				}
				})
				.catch(error => console.error("Error:", error));
			}

			document.getElementById("reloadButton").addEventListener("click", function() {
				location.reload();
			});
		</script>
		<script>
			document.getElementById('submitRating').addEventListener('click', function () {
				const ratedCustomerId = '{{customer.id}}';
				const stars = document.getElementById('stars').value;
				const comment = document.getElementById('comment').value;
	
				// Validate form fields
				if (!ratedCustomerId || !stars) {
					alert('Please fill out all required fields.');
					return;
				}
	
				// Prepare the data
				const data = {
					rated_customer_id: ratedCustomerId,
					stars: parseInt(stars, 10),
					comment: comment
				};
	            console.log('we are in ratings')
				// Send data to the backend
				fetch('/rate_customer', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
						'X-CSRFToken': '{{ csrf_token }}'
					},
					body: JSON.stringify(data),
				})
					.then(response => response.json())
					.then(data => {
						if (data.error) {
							alert(`Error: ${data.error}`);
						} else {
							window.location.reload();
						}
					})
					.catch(error => {
						console.error('Error:', error);
						// alert('An error occurred while submitting your rating.');
					});
			});
		</script>
		<script>
			function goBack() {
			  window.history.back();
			}
		</script>
	{% endblock %}